<!DOCTYPE html>
<meta charset="UTF-8">
<html><head><style id="neomacs-style-COMMON">@font-face{
    font-family: Space Mono;
    font-style: normal;
    font-weight: 400;
    src: url("neomacs://sys/space-mono/SpaceMono-Regular.ttf") format("truetype");
}

@font-face{
    font-family: Space Mono;
    font-style: italic;
    font-weight: 400;
    src: url("neomacs://sys/space-mono/SpaceMono-Italic.ttf") format("truetype");
}

@font-face{
    font-family: Space Mono;
    font-style: normal;
    font-weight: 700;
    src: url("neomacs://sys/space-mono/SpaceMono-Bold.ttf") format("truetype");
}

@font-face{
    font-family: Space Mono;
    font-style: italic;
    font-weight: 700;
    src: url("neomacs://sys/space-mono/SpaceMono-BoldItalic.ttf") format("truetype");
}

@font-face{
    font-family: CMU Concrete;
    font-style: normal;
    font-weight: 400;
    src: url("neomacs://sys/cmu-concrete/cmunorm.ttf") format("truetype");
}

@font-face{
    font-family: CMU Concrete;
    font-style: italic;
    font-weight: 400;
    src: url("neomacs://sys/cmu-concrete/cmunoti.ttf") format("truetype");
}

@font-face{
    font-family: CMU Concrete;
    font-style: normal;
    font-weight: 700;
    src: url("neomacs://sys/cmu-concrete/cmunobx.ttf") format("truetype");
}

@font-face{
    font-family: CMU Concrete;
    font-style: italic;
    font-weight: 700;
    src: url("neomacs://sys/cmu-concrete/cmunobi.ttf") format("truetype");
}

@font-face{
    font-family: DejaVu Sans Mono;
    font-style: normal;
    font-weight: 400;
    src: url("neomacs://sys/dejavu-sans-mono/DejaVuSansMono.ttf") format("truetype");
}

@font-face{
    font-family: DejaVu Sans Mono;
    font-style: italic;
    font-weight: 400;
    src: url("neomacs://sys/dejavu-sans-mono/DejaVuSansMono-Oblique.ttf") format("truetype");
}

@font-face{
    font-family: DejaVu Sans Mono;
    font-style: normal;
    font-weight: 700;
    src: url("neomacs://sys/dejavu-sans-mono/DejaVuSansMono-Bold.ttf") format("truetype");
}

@font-face{
    font-family: DejaVu Sans Mono;
    font-style: italic;
    font-weight: 700;
    src: url("neomacs://sys/dejavu-sans-mono/DejaVuSansMono-BoldOblique.ttf") format("truetype");
}</style><style id="neomacs-style-BUFFER">body{
    font-family: CMU Concrete;
    color: #54454d;
}

.focus{
    background-color: rgba(169,151,160,0.1);
}

.focus-tail{
    background-color: rgba(169,151,160,0.1);
}

.focus-tail::after{
    content: " ";
    display: inline-block;
    white-space: pre-wrap;
    width: 0.4em;
    background-color: rgba(169,151,160,0.5);
    color: #54454d;
}

.range-selection{
    background-color: rgba(169,151,160,0.5);
    color: #54454d;
}

code{
    font-family: monospace;
}

:link{
    font-family: CMU Concrete;
    color: #54454d;
}

.invisible{
    display: none;
}

::highlight(neomacs){
    position: absolute;
    min-height: 1em;
    min-width: 0.3em;
    z-index: -1;
    background-color: rgba(169,151,160,0.5);
    color: #54454d;
}

::highlight(neomacs-range){
    background-color: rgba(169,151,160,0.5);
    color: #54454d;
}

#neomacs-cursor{
    position: absolute;
    min-height: 1em;
    min-width: 0.3em;
    z-index: -1;
    background-color: rgba(169,151,160,0.5);
    color: #54454d;
}

::-webkit-scrollbar{
    display: none;
}</style><style id="neomacs-style-DOC-MODE">body{
    left: 0;
    right: 0;
    white-space: pre-wrap;
    padding-left: 1em;
}

body.focus-tail::after{
    content: "  ";
    white-space: pre;
    background-color: rgba(169,151,160,0.5);
    color: #54454d;
}</style><style id="neomacs-style-LISP-MODE">.symbol{
    display: inline-block;
    vertical-align: top;
    position: relative;
    white-space: pre;
}

.symbol:not(:last-child):not(.focus-tail){
    margin-right: 0.4em;
}



.symbol:empty::after{
    content: "_";
}

.symbol:empty:not(:last-child){
    margin-right: 0.4em;
}

.symbol:empty.focus-tail::after{
    content: "_";
    width: auto;
    background-color: rgba(169,151,160,0.5);
    color: #54454d;
}

.string{
    display: inline-block;
    vertical-align: top;
    position: relative;
    white-space: pre;
    color: #a997a0;
}

.string::before{
    content: "\"";
}

.string::after{
    content: "\"";
}

.string:not(:last-child){
    margin-right: 0.4em;
}

.string.focus::before{
    background-color: rgba(169,151,160,0.5);
    color: #54454d;
}

.string.focus-tail::after{
    content: "\"";
    width: auto;
    background-color: rgba(169,151,160,0.5);
    color: #54454d;
}

.string:not(:last-child):not(.focus-tail){
    margin-right: 0.4em;
}

.object{
    display: inline-block;
    vertical-align: top;
    position: relative;
    white-space: pre;
    text-decoration: underline;
}

.object:not(:last-child):not(.focus-tail){
    margin-right: 0.4em;
}

.symbol[symbol-type="ghost"]{
    margin-right: 0!important;
}

.symbol[symbol-type="macro"][operator]{
    color: #d29fa8;
}

.symbol[symbol-type="keyword"]{
    color: #d29fa8;
}

.symbol[symbol-type="special-operator"][operator]{
    color: #d29fa8;
}

.list{
    display: inline-block;
    vertical-align: top;
    position: relative;
    white-space: pre;
    padding-left: 0.4em;
}

.list::before{
    content: "(";
    margin-left: -0.4em;
}

.list::after{
    content: ")";
    vertical-align: bottom;
}

.list:not(:last-child){
    margin-right: 0.4em;
}

.list.focus-tail::after{
    content: ")";
    width: auto;
    background-color: rgba(169,151,160,0.5);
    color: #54454d;
}

.list.focus::before{
    background-color: rgba(169,151,160,0.5);
    color: #54454d;
}

.list:not(:last-child):not(.focus-tail){
    margin-right: 0.4em;
}

.comment{
    display: inline-block;
    white-space: pre-wrap;
}

.comment::after{
    content: "‚Å£";
}

.comment[comment-level="1"]{
    position: sticky;
    left: 20em;
    border-left: 0.3rem solid #a997a0;
    padding-left: 0.3rem;
    color: #a997a0;
}

.comment[comment-level="2"]{
    border-left: 0.3rem solid #a997a0;
    padding-left: 0.3rem;
    color: #a997a0;
}

.comment[comment-level="3"]{
    font-size: 1.2em;
    color: #a997a0;
}

.comment[comment-level="3"]::before{
    content: "";
    display: list-item;
    position: absolute;
}

.comment[comment-level="4"]{
    font-size: 1.1em;
    color: #a997a0;
}

.comment[comment-level="4"]::before{
    content: "";
    display: list-item;
    position: absolute;
}

[compiler-note-severity="note"]{
    border: solid 1px rgba(169,151,160,1.0);
}

[compiler-note-severity="style-warning"]{
    border: dashed 1px rgba(240,0,120,1.0);
}

[compiler-note-severity="warning"]{
    border: solid 1px rgba(240,0,120,1.0);
}

[compiler-note-severity="error"]{
    border: double 1px rgba(240,0,120,1.0);
}</style><style id="neomacs-style-HTML-DOC-MODE">:empty::after{
    content: "_";
}

li p{
    margin: 0;
}

body{
    white-space: normal;
    max-width: 48rem;
    text-align: justify;
    hyphens: auto;
}

.comma-expr::before{
    content: ",";
}

.comma-expr{
    border: solid 1px currentColor;
}</style></head><body><h1 operator="" id="editing">Editing</h1><h2 id="editing-primitives">Editing primitives</h2><p>Lisp programs are expected to use the following primitives to edit the Neomacs DOM. These primitives provides <a href="positions.html">positions</a>-based interface and handles text-node splitting and merging automatically. These primitives also maintain <a href="undo.html">undo</a> history, update renderer-side DOM,  manage setup and destruction of observers and computed attributes, and allocate <code>neomacs-identifier</code>&#39;s.</p><dl><dt>Function: <code>delete-nodes</code> <code>(beg end)</code></dt><dd>Delete nodes between BEG and END and returns nil.</dd><dd>BEG and END must be sibling positions.  If END is nil, delete children
starting from BEG till the end of its parent.</dd><dt>Function: <code>extract-nodes</code> <code>(beg end)</code></dt><dd>Like <code>delete-nodes</code>, but clone and return the deleted contents.</dd><dt>Function: <code>insert-nodes</code> <code>(marker-or-pos &amp;rest things)</code></dt><dd>Insert THINGS at MARKER-OR-POS.</dd><dd>THINGS can be DOM nodes or strings, which are converted to text nodes.</dd><dt>Function: <code>move-nodes</code> <code>(beg end to)</code></dt><dd>Move nodes between BEG and END to TO and returns nil.</dd><dd>BEG and END must be sibling positions.  If END is nil, move children
starting from BEG till the end of its parent.</dd></dl><h2 id="editing-hooks">Editing hooks</h2><p>More often than not the structured data in a buffer only makes sense if they follow certain constraints or invariants. Neomacs provides a number of facilities to help enforcing invariants, including <a href="dom.html#attributes">computed attributes</a>, <a href="command-loop.html#buffer-transactions">pre/post command hooks</a> and the following facilities.</p><p>Catch all nodes entering and leaving a buffer&#39;s DOM:</p><dl><dt>Progn generic function: <code>on-node-setup</code> <code>(buffer node)</code></dt><dd>Run some action when NODE is inserted into BUFFER.</dd><dd>NODE can be either an <code>element</code> or a <code>text-node</code>.</dd><dt>Progn generic function: <code>on-node-cleanup</code> <code>(buffer node)</code></dt><dd>Run some action when NODE is removed from BUFFER.</dd><dd>NODE can be either an <code>element</code> or a <code>text-node</code>.</dd></dl><p>Schedule some action to run after current command invocation if a node is edited:</p><dl><dt>Macro: <code>with-post-command</code> <code>((node &amp;rest slots) &amp;body body)</code></dt><dd>Run BODY at the end of current command, if any SLOTS of NODE is
changed.</dd></dl><p>Typically, <code>on-node-setup</code> is used to register some computed attributes and post command actions depending on type of node being inserted. <code>with-post-command</code> should be used to restore invariants instead of adding observers (via <code>lwcells</code>&#39;s <code>add-observer</code>) that directly edits the DOM, because observers can run in the middle of compound editing operations and commands which might cause unpredictable behavior.</p><h2 id="compound-editing-operations">Compound editing operations</h2><p>Functions implemented using <a href="#editing-primitives">editing primitives</a>, provided for convenience:</p><dl><dt>Function: <code>splice-node</code> <code>(node)</code></dt><dd>Splice children of NODE in place of NODE itself.</dd><dt>Function: <code>join-nodes</code> <code>(dst src)</code></dt><dd>Join DST and SRC nodes.</dd><dd>This moves all children of SRC into DST and deletes SRC.</dd><dt>Function: <code>raise-node</code> <code>(node)</code></dt><dd>Replace NODE&#39;s parent with NODE.</dd><dt>Function: <code>split-node</code> <code>(&amp;optional (pos (focus)))</code></dt><dd>Split node containing POS at POS.</dd><dd>Let parent be the node containing POS. This involves inserting a clone
of parent after parent, and moving children after POS into the
clone. Returns the cloned node (i.e. the node after the split point).</dd><dt>Function: <code>wrap-node</code> <code>(node new-node)</code></dt><dd>Insert NEW-NODE around NODE.</dd><dd>NODE becomes the last child of NEW-NODE.</dd><dt>Function: <code>delete-node</code> <code>(node)</code></dt><dd>Delete a single NODE.</dd><dt>Function: <code>replace-node</code> <code>(node new-node)</code></dt><dd>Replace NODE with NEW-NODE.</dd></dl><h2 id="editing-commands">Editing commands</h2><p>The following generic editing commands are avaliable in any Neomacs buffer:</p><dl><dt>Command (<code>enter</code>): <code>new-line</code> <code>(&amp;optional (marker (focus)))</code></dt><dd>Insert a new line node (br element) at MARKER.</dd><dt>Command (<code>backspace</code>): <code>backward-delete</code> <code>(&amp;optional (marker (focus)))</code></dt><dt>Command (<code>C-d</code>): <code>forward-delete</code> <code>(&amp;optional (marker (focus)))</code></dt><dt>Command (<code>M-backspace</code>): <code>backward-delete-word</code> <code>(&amp;optional (marker (focus)))</code></dt><dt>Command (<code>space, !, &quot;, #, $, %, &amp;, &#39;, (, ), *, +, ,, -, ., /, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, :, ;, &lt;, =, &gt;, ?, @, A, B, C, D, E, F, G, H, I, J, K, L, M, N, O, P, Q, R, S, T, U, V, W, X, Y, Z, [, \, ], ^, _, `, a, b, c, d, e, f, g, h, i, j, k, l, m, n, o, p, q, r, s, t, u, v, w, x, y, z, {, |, }, ~, &nbsp;, ¬°, ¬¢, ¬£, ¬§, ¬•, ¬¶, ¬ß, ¬®, ¬©, ¬™, ¬´, ¬¨, ¬≠, ¬Æ, ¬Ø, ¬∞, ¬±, ¬≤, ¬≥, ¬¥, ¬µ, ¬∂, ¬∑, ¬∏, ¬π, ¬∫, ¬ª, ¬º, ¬Ω, ¬æ, ¬ø, √Ä, √Å, √Ç, √É, √Ñ, √Ö, √Ü, √á, √à, √â, √ä, √ã, √å, √ç, √é, √è, √ê, √ë, √í, √ì, √î, √ï, √ñ, √ó, √ò, √ô, √ö, √õ, √ú, √ù, √û, √ü, √†, √°, √¢, √£, √§, √•, √¶, √ß, √®, √©, √™, √´, √¨, √≠, √Æ, √Ø, √∞, √±, √≤, √≥, √¥, √µ, √∂, √∑, √∏, √π, √∫, √ª, √º, √Ω, √æ</code>): <code>self-insert-command</code> <code>()</code></dt><dd>Insert the last typed character into current buffer.</dd></dl><h2 id="the-clipboard">The clipboard</h2><dl><dt>Variable: <code>*clipboard-ring*</code></dt><dt>Variable: <code>*clipboard-ring-index*</code></dt></dl><h2 id="clipboard-commands">Clipboard commands</h2><dl><dt>Command (<code>C-w</code>): <code>cut-element</code> <code>()</code></dt><dd>Cut element under focus and save into clipboard.</dd><dd>If selection is active, cut selected contents instead.</dd><dt>Command (<code>M-w</code>): <code>copy-element</code> <code>()</code></dt><dd>Copy element under focus into clipboard.</dd><dd>If selection is active, copy selected contents instead.</dd><dt>Command (<code>C-y</code>): <code>paste</code> <code>()</code></dt><dd>Paste the first item in clipboard.</dd><dt>Command (<code>M-y</code>): <code>paste-pop</code> <code>()</code></dt><dd>cycle pasted contents, or prompt for a clipboard item to paste.</dd><dt>Command (<code>C-k</code>): <code>forward-cut</code> <code>(&amp;optional (pos (focus)))</code></dt><dd>Cut until end of line and save into clipboard.</dd></dl></body></html>